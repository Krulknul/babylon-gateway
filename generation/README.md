# Generated Dependencies

Details on each generated dependency are below.

## Generating API models/clients from the Open API specs

For being a client to the Core API, and for exposing the Gateway API, we use auto-generated models.

### Prerequisites

* Install the [openapi-generator](https://github.com/OpenAPITools/openapi-generator) (eg with `brew install openapi-generator`)
* Installed the dotnet SDK version 5+


### Regenerating the Core API client

With all paths relative to the repo root, proceed as follows:

* Copy the relevant Core API spec from the `radixdlt` repo, and replace the contents of `./generation/core-api-spec-copy.yml`. You may need to change the spec version to "3.0.0" so that it works with code gen, until [openapi-generator supports 3.1.0](https://github.com/OpenAPITools/openapi-generator/issues/9083).
* Run `./generation/regenerate-core-api.sh`

### Regenerating the Gateway API models

With all paths relative to the repo root, proceed as follows:

* Update `./gateway-api-schema.yaml` for any changes you'd like to make. Be sure to discuss any non-backwards compatible changes. Keep the docs updated in the schema.
* You may need to temporarily change the spec version to "3.0.0" so that it works with code gen, until [openapi-generator supports 3.1.0](https://github.com/OpenAPITools/openapi-generator/issues/9083).
* Run `./generation/regenerate-gateway-api.sh`

### Useful reading

* Docs on [general openapi-generator configuration are here](https://openapi-generator.tech/docs/configuration/).
* Docs on the [csharp-netcore specific configuration are here](https://openapi-generator.tech/docs/generators/csharp-netcore).
* The PR implementing the [httpclient implementation is here](https://github.com/OpenAPITools/openapi-generator/pull/8821).

### Transitive dependencies

For reference, at initial build time, the dependencies specified were:
  * "JsonSubTypes": "1.8.0",
  * "Newtonsoft.Json": "12.0.3",
  * "Polly": "7.2.1", (https://github.com/App-vNext/Polly - for retry logic)
  * "System.ComponentModel.Annotations": "5.0.0"

## License Headers

License headers should be prepended to all main code files. Run `./generation/ensure-license-headers.sh` to fix any issues here.

## Migrations

To start, read the [docs on EF Core migrations](https://docs.microsoft.com/en-us/ef/core/managing-schemas/migrations).

EF Core migrations are generated by running `./generation/generate-migration.sh [NameOfMigration]`, replacing `[NameOfMigration]` with an UpperCamelCase migration name, describing the change made (no spaces please).

The script outputs the migration C# files, as well as an idempotent SQL script which is used for production deployments.

The script also prints instructions to help with reviewing and amending the migration - please follow these to ensure the migration is not destructive and works correctly when deployed.

### Starting migrations from scratch

In the case where the database schema needs to start from scratch, you can run `./generation/regenerate-first-migration.sh` - this should not be done if any backwards-compatibility is needed in production.
